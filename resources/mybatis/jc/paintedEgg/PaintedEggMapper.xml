<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jy.repository.jc.paintedEgg.PaintedEggDao">
    <resultMap id="BaseResultMap" type="PaintedEgg">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="eggId" property="eggid" jdbcType="VARCHAR"/>
        <result column="goods_id" property="goodsId" jdbcType="VARCHAR"/>
        <result column="match_id" property="matchId" jdbcType="VARCHAR"/>
        <result column="content" property="content" jdbcType="VARCHAR"/>
        <result column="state" property="state" jdbcType="INTEGER"/>
        <result column="price" property="price" jdbcType="INTEGER"/>
        <result column="purchased" property="purchased" jdbcType="INTEGER"/>
        <result column="lowerLimit" property="lowerlimit" jdbcType="INTEGER"/>
        <result column="rightAnswerId" property="rightanswerid" jdbcType="VARCHAR"/>
        <result column="createTime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="endTime" property="endtime" jdbcType="TIMESTAMP"/>
        <result column="updateTime" property="updatetime" jdbcType="TIMESTAMP"/>
        <result column="operId" property="operid" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="BaseResultAnsertMap" type="PaintedEggAnswer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="answerId" property="answerid" jdbcType="VARCHAR"/>
        <result column="eggId" property="eggid" jdbcType="VARCHAR"/>
        <result column="answer" property="answer" jdbcType="VARCHAR"/>
        <result column="sort" property="sort" jdbcType="INTEGER"/>
        <result column="createTime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="updateTime" property="updatetime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <resultMap id="BaseResultWinerMap" type="PaintedEggWiner">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <result column="eggId" property="eggid" jdbcType="VARCHAR"/>
        <result column="user_id" property="userId" jdbcType="VARCHAR"/>
        <result column="luckyNum" property="luckynum" jdbcType="INTEGER"/>
        <result column="createTime" property="createtime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <resultMap id="BaseResulUsertMap" type="PaintedEggUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="eggUserLogId" property="egguserlogid" jdbcType="VARCHAR"/>
        <result column="eggId" property="eggid" jdbcType="VARCHAR"/>
        <result column="user_id" property="userId" jdbcType="VARCHAR"/>
        <result column="account_log_id" property="accountLogId" jdbcType="VARCHAR"/>
        <result column="luckyNumStart" property="luckynumstart" jdbcType="INTEGER"/>
        <result column="luckyNumEnd" property="luckynumend" jdbcType="INTEGER"/>
        <result column="totalCnt" property="totalcnt" jdbcType="INTEGER"/>
        <result column="isRight" property="isright" jdbcType="INTEGER"/>
        <result column="createTime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="updateTime" property="updatetime" jdbcType="TIMESTAMP"/>
        <result column="answerId" property="answerId" jdbcType="TIMESTAMP"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        eggId, goods_id, match_id, content, state, price, purchased, lowerLimit, rightAnswerId,
        createTime, updateTime, operId,endTime
    </sql>
    <select id="find" resultMap="BaseResultMap" parameterType="PaintedEgg">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->

        select
        e.eggId, g.goods_id, m.match_id, e.content, e.state, e.price, e.purchased, e.lowerLimit, e.rightAnswerId,
        e.createTime, e.updateTime, e.endTime,e.operId,g.title,m.team_id1,m.team_id2
        from jc_painted_egg e ,jc_goods g, jc_match m
        where eggId = #{eggid,jdbcType=VARCHAR}
        and e.goods_id = g.goods_id
        and e.match_id = m.match_id
    </select>
    <select id="findByPage" resultMap="BaseResultMap" parameterType="PaintedEgg">
        select
        e.eggId, g.goods_id, m.match_id, e.content, e.state, e.price, e.purchased, e.lowerLimit, e.rightAnswerId,
        e.createTime, e.updateTime,e.endTime, e.operId,g.title,m.team_id1,m.team_id2
        from jc_painted_egg e ,jc_goods g, jc_match m
        where 1=1
        and e.goods_id = g.goods_id
        and e.match_id = m.match_id
        <if test="param.keyWord != null and param.keyWord != ''">
            and (
            e.content LIKE CONCAT('%',#{param.keyWord},'%')
            or e.eggid LIKE CONCAT('%',#{param.keyWord},'%')
            )
        </if>
        order by eggId desc
    </select>
    <delete id="delete" parameterType="PaintedEgg">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from jc_painted_egg
        where eggId = #{eggid,jdbcType=VARCHAR}
    </delete>
    <delete id="deleteBatch" parameterType="java.util.List">
        delete from jc_painted_egg
        where eggId in (
        <foreach item="o" collection="list" open="" separator=","
                 close="">
            #{o.eggid}
        </foreach>
        )
    </delete>
    <insert id="insert" parameterType="PaintedEgg">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into jc_painted_egg (eggId, goods_id, match_id,
        content, state, price,
        purchased, lowerLimit, rightAnswerId,
        createTime, updateTime, operId,endTime
        )
        values (#{eggid,jdbcType=VARCHAR}, #{goodsId,jdbcType=VARCHAR}, #{matchId,jdbcType=VARCHAR},
        #{content,jdbcType=VARCHAR}, #{state,jdbcType=INTEGER}, #{price,jdbcType=INTEGER},
        #{purchased,jdbcType=INTEGER}, #{lowerlimit,jdbcType=INTEGER}, #{rightanswerid,jdbcType=VARCHAR},
        #{createtime,jdbcType=TIMESTAMP}, #{updatetime,jdbcType=TIMESTAMP}, #{operid,jdbcType=VARCHAR},
        #{endtime,jdbcType=TIMESTAMP}
        )
    </insert>
    <update id="update" parameterType="PaintedEgg">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update jc_painted_egg
        <set>
            <if test="goodsId != null">
                goods_id = #{goodsId,jdbcType=VARCHAR},
            </if>
            <if test="matchId != null">
                match_id = #{matchId,jdbcType=VARCHAR},
            </if>
            <if test="content != null">
                content = #{content,jdbcType=VARCHAR},
            </if>
            <if test="state != null">
                state = #{state,jdbcType=INTEGER},
            </if>
            <if test="price != null">
                price = #{price,jdbcType=INTEGER},
            </if>
            <if test="purchased != null">
                purchased = #{purchased,jdbcType=INTEGER},
            </if>
            <if test="lowerlimit != null">
                lowerLimit = #{lowerlimit,jdbcType=INTEGER},
            </if>
            <if test="rightanswerid != null">
                rightAnswerId = #{rightanswerid,jdbcType=VARCHAR},
            </if>
            <if test="createtime != null">
                createTime = #{createtime,jdbcType=TIMESTAMP},
            </if>
            <if test="updatetime != null">
                updateTime = #{updatetime,jdbcType=TIMESTAMP},
            </if>
            <if test="operid != null">
                operId = #{operid,jdbcType=VARCHAR},
            </if>
            <if test="endtime != null">
                endTime = #{endtime,jdbcType=TIMESTAMP},
            </if>
        </set>
        where eggId = #{eggid,jdbcType=VARCHAR}
    </update>
    <!-- 查询所有的答案 -->
    <select id="queryPaintedEggAnswer" resultMap="BaseResultAnsertMap" parameterType="PaintedEggAnswer">
     select s.answerId, s.eggId, s.answer, s.sort, s.createTime, s.updateTime ,e.rightAnswerId
    from jc_painted_egg_answer s,jc_painted_egg e
    where s.eggId = #{eggid,jdbcType=VARCHAR}
    and  s.eggId = e.eggId
    order by sort
  </select>

    <insert id="insertAnswerBatch" parameterType="PaintedEggAnswer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into jc_painted_egg_answer (answerId, eggId, answer, sort, createTime, updateTime)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.answerid},#{item.eggid},#{item.answer},#{item.sort},#{item.createtime},#{item.updatetime})
        </foreach>
    </insert>
    <delete id="deleteAnswerBatch" parameterType="PaintedEggAnswer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from jc_painted_egg_answer
        where eggId = #{eggid,jdbcType=VARCHAR}
    </delete>


    <!-- 查询所有的中奖 -->
    <select id="queryPaintedEggWinner" resultMap="BaseResultWinerMap" parameterType="PaintedEggWiner">
    select u.nick_name,w.luckyNum,w.status,w.user_id,w.eggId from jc_user u ,jc_painted_egg_winner w
	where u.user_id = w.user_id
    and eggId = #{eggid,jdbcType=VARCHAR}
  </select>
    <select id="queryPaintedEggUser" resultMap="BaseResulUsertMap" parameterType="PaintedEggUser">
        select u.nick_name, u.mobile, w.* from jc_user u ,jc_painted_egg_user w
        where u.user_id = w.user_id
        <if test="param.eggid != null">
            and w.eggId = #{param.eggid,jdbcType=VARCHAR}
        </if>
        <if test="param.keyWord != null">
            and (
            u.nick_name LIKE CONCAT('%',#{param.keyWord},'%')
            )
        </if>
        order by w.createTime
    </select>

    <insert id="zdWin" parameterType="PaintedEggWiner">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into jc_painted_egg_winner (eggId, user_id, luckyNum,
        createTime,status)
        values (#{eggid,jdbcType=VARCHAR}, #{userId,jdbcType=VARCHAR}, #{luckynum,jdbcType=INTEGER},
        #{createtime,jdbcType=TIMESTAMP}, #{status,jdbcType=INTEGER})
    </insert>

    <select id="queryUserBuyList" resultMap="BaseResulUsertMap" parameterType="PaintedEggUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select eggUserLogId, eggId, user_id, account_log_id, luckyNumStart, luckyNumEnd, totalCnt,
        answerId, isRight, createTime, updateTime from jc_painted_egg_user
        where 1=1
        <if test="eggid != null and eggid != ''">
            and eggId = #{eggid,jdbcType=VARCHAR}
        </if>
        <if test="userId != null and userId != ''">
            and user_id = #{userId,jdbcType=VARCHAR}
        </if>
        <if test="isright != null and isright != '' and isright  &lt;= 1">
            and isRight = #{isright,jdbcType=INTEGER}
        </if>
        <if test="lucyNum != null and lucyNum != ''">
            and luckyNumStart &lt;= #{lucyNum,jdbcType=INTEGER}
            and luckyNumEnd &gt;= #{lucyNum,jdbcType=INTEGER}
        </if>
        order by createTime desc
    </select>

    <update id="updateWin" parameterType="PaintedEggWiner">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        update jc_painted_egg_winner
        <set>
            <if test="userId != null">
                user_id = #{userId,jdbcType=VARCHAR},
            </if>
            <if test="luckynum != null">
                luckyNum = #{luckynum,jdbcType=VARCHAR},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=INTEGER},
            </if>

        </set>
        where eggId = #{eggid,jdbcType=VARCHAR}
    </update>


    <select id="queryEggMaxUserInfo" resultMap="BaseResulUsertMap" parameterType="PaintedEggUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select MAX(luckyNumStart) luckyNumStart,MAX(luckyNumEnd) luckyNumEnd ,SUM(totalCnt) totalCnt from
        jc_painted_egg_user
    </select>
    <update id="ModifyAnswerUserBatch" parameterType="PaintedEggUser">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        update jc_painted_egg_user
        <set>
            isRight = 1,
            answerId = #{answerId,jdbcType=VARCHAR}
        </set>
        where eggId = #{eggid,jdbcType=VARCHAR}
        and (answerId = #{answerId,jdbcType=VARCHAR} or answerId = '')
    </update>

    <insert id="insertUserAnswer" parameterType="PaintedEggUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into jc_painted_egg_user (eggUserLogId, eggId, user_id,
        account_log_id, luckyNumStart, luckyNumEnd,
        totalCnt, answerId,isRight, createTime,
        updateTime)
        values (#{egguserlogid,jdbcType=VARCHAR}, #{eggid,jdbcType=VARCHAR}, #{userId,jdbcType=VARCHAR},
        #{accountLogId,jdbcType=VARCHAR}, #{luckynumstart,jdbcType=INTEGER}, #{luckynumend,jdbcType=INTEGER},
        #{totalcnt,jdbcType=INTEGER},#{answerId,jdbcType=VARCHAR}, #{isright,jdbcType=INTEGER},
        #{createtime,jdbcType=TIMESTAMP},
        #{updatetime,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertUserBatch" parameterType="PaintedEggUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into jc_painted_egg_user (eggUserLogId, eggId, user_id,
        account_log_id, luckyNumStart, luckyNumEnd,
        totalCnt, answerId,isRight, createTime,
        updateTime)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.egguserlogid},#{item.eggid},#{item.userId},
            #{item.accountLogId},#{item.luckynumstart},#{item.luckynumend},
            #{item.totalcnt},#{item.answerId},#{item.isright},#{item.createtime},#{item.updatetime})
        </foreach>
    </insert>
    <!-- 查询购买猜蛋后50名的时间总和 并且答案是正确的-->
    <select id="getByUer50" resultMap="BaseResulUsertMap" parameterType="PaintedEggUser">
    select sum(date_format(createTime, '%Y%m%d%H%i%s'))  timeCount from jc_painted_egg_user  
    where eggId = #{eggid,jdbcType=VARCHAR}
    and isRight = '1'
    order by createtime desc LIMIT 50
  </select>


</mapper>