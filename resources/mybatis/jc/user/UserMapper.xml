<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jy.repository.jc.user.UserDao">
    <resultMap id="BaseResultMap" type="jcuser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="user_id" property="userId" jdbcType="VARCHAR"/>
        <result column="mobile" property="mobile" jdbcType="VARCHAR"/>
        <result column="password" property="password" jdbcType="VARCHAR"/>
        <result column="head_icon" property="headIcon" jdbcType="VARCHAR"/>
        <result column="real_name" property="realName" jdbcType="VARCHAR"/>
        <result column="id_card" property="idCard" jdbcType="VARCHAR"/>
        <result column="nick_name" property="nickName" jdbcType="VARCHAR"/>
        <result column="signature" property="signature" jdbcType="VARCHAR"/>
        <result column="invite_code" property="inviteCode" jdbcType="VARCHAR"/>
        <result column="follow_count" property="followCount" jdbcType="BIGINT"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="oper_id" property="operId" jdbcType="VARCHAR"/>
        <result column="is_valid" property="isValid" jdbcType="INTEGER"/>
        <result column="is_robot" property="isRobot" jdbcType="INTEGER"/>
    </resultMap>

    <resultMap id="userAddressMap" type="UserAddress" >
        <result column="addressId" property="addressid" jdbcType="VARCHAR" />
        <result column="user_id" property="userId" jdbcType="VARCHAR" />
        <result column="addressee" property="addressee" jdbcType="VARCHAR" />
        <result column="contact" property="contact" jdbcType="VARCHAR" />
        <result column="region" property="region" jdbcType="VARCHAR" />
        <result column="address" property="address" jdbcType="VARCHAR" />
        <result column="isDefault" property="isdefault" jdbcType="INTEGER" />
        <result column="createTime" property="createtime" jdbcType="TIMESTAMP" />
        <result column="updateTime" property="updatetime" jdbcType="TIMESTAMP" />
    </resultMap>

    <sql id="Base_Column_List">
    user_id, mobile, password, head_icon, real_name, id_card, nick_name, signature, invite_code,
    follow_count, create_time, update_time,is_valid,oper_id,is_robot
  </sql>
    <select id="find" resultMap="BaseResultMap" parameterType="jcuser">
        select
        <include refid="Base_Column_List"/>
        from jc_user
        where user_id = #{userId,jdbcType=VARCHAR}
    </select>
    <select id="findByPage" resultMap="BaseResultMap" parameterType="jcuser">
        select
        <include refid="Base_Column_List"/>
        from jc_user
        where 1=1
        <if test="param.isValid != null ">
            AND is_valid=#{param.isValid}
        </if>
        <if test="param.isRobot != null ">
            AND is_robot=#{param.isRobot}
        </if>
        <if test="param.keyWord != null">
            and (
            user_id LIKE CONCAT('%',#{param.keyWord},'%')
            or mobile LIKE CONCAT('%',#{param.keyWord},'%')
            or real_name LIKE CONCAT('%',#{param.keyWord},'%')
            or id_card LIKE CONCAT('%',#{param.keyWord},'%')
            or nick_name LIKE CONCAT('%',#{param.keyWord},'%')
            or invite_code LIKE CONCAT('%',#{param.keyWord},'%')
            )
        </if>
    </select>
    <delete id="delete" parameterType="jcuser">
    delete from jc_user
    where user_id = #{userId,jdbcType=VARCHAR}
  </delete>
    <delete id="deleteBatch" parameterType="java.util.List">
        delete from jc_user
        where user_id in (
        <foreach item="o" collection="list" open="" separator="," close="">
            #{o.userId}
        </foreach>
        )
    </delete>
    <insert id="insert" parameterType="jcuser">
    insert into jc_user (user_id, mobile, password,
      head_icon, real_name, id_card, 
      nick_name, signature, invite_code, 
      follow_count, create_time, update_time,is_valid,oper_id,is_robot
      )
    values (#{userId,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR},
      #{headIcon,jdbcType=VARCHAR}, #{realName,jdbcType=VARCHAR}, #{idCard,jdbcType=VARCHAR},
      #{nickName,jdbcType=VARCHAR}, #{signature,jdbcType=VARCHAR}, #{inviteCode,jdbcType=VARCHAR},
      #{followCount,jdbcType=BIGINT}, #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP},
      #{isValid,jdbcType=VARCHAR}, #{operId,jdbcType=VARCHAR},#{isRobot,jdbcType=INTEGER}
      )
  </insert>
    <update id="update" parameterType="jcuser">
        update jc_user
        <set>
            <if test="mobile != null">
                mobile = #{mobile,jdbcType=VARCHAR},
            </if>
            <if test="password != null">
                password = #{password,jdbcType=VARCHAR},
            </if>
            <if test="headIcon != null">
                head_icon = #{headIcon,jdbcType=VARCHAR},
            </if>
            <if test="realName != null">
                real_name = #{realName,jdbcType=VARCHAR},
            </if>
            <if test="idCard != null">
                id_card = #{idCard,jdbcType=VARCHAR},
            </if>
            <if test="nickName != null">
                nick_name = #{nickName,jdbcType=VARCHAR},
            </if>
            <if test="signature != null">
                signature = #{signature,jdbcType=VARCHAR},
            </if>
            <if test="inviteCode != null">
                invite_code = #{inviteCode,jdbcType=VARCHAR},
            </if>
            <if test="followCount != null">
                follow_count = #{followCount,jdbcType=BIGINT},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isValid != null">
                is_valid = #{isValid,jdbcType=VARCHAR},
            </if>
            <if test="operId != null">
                oper_id = #{operId,jdbcType=VARCHAR},
            </if>
             <if test="isRobot != null" >
        		#{isRobot,jdbcType=INTEGER},
     		 </if>
        </set>
        where user_id = #{userId,jdbcType=VARCHAR}
    </update>

    <!--总发单数-->
    <select id="getSendRecommendCnt" resultType="int" parameterType="jcuser">
        SELECT COUNT(*) FROM jc_recommend_bill WHERE user_id=#{userId}
        <if test="searchStartTime != null and searchStartTime != '' ">
          and DATE_FORMAT(create_time, '%Y-%m-%d') &gt;= #{searchStartTime}
        </if>
        <if test="searchEndTime != null and searchEndTime != ''">
            and DATE_FORMAT(create_time, '%Y-%m-%d') &lt;= #{searchEndTime}
        </if>
    </select>
    <!--总购买发单数-->
    <select id="getBuyRecommendCnt" resultType="int" parameterType="jcuser">
      SELECT COUNT(*) FROM jc_user_recommend_rel WHERE user_id=#{userId}
        <if test="searchStartTime != null">
            and create_time &gt;= #{searchStartTime}
        </if>
        <if test="searchEndTime != null">
            and create_time &lt;= #{searchEndTime}
        </if>
    </select>


    <!--关注的人数-->
    <select id="getFollowCnt" resultType="int" parameterType="jcuser">
      SELECT COUNT(*) FROM jc_follow WHERE user_id=#{userId}
    </select>

    <!--粉丝人数-->
    <select id="getFansCnt" resultType="int" parameterType="jcuser">
        SELECT COUNT(*) FROM jc_follow WHERE follow_user_id=#{userId}
    </select>

    <select id="getUserAddress" resultMap="userAddressMap" parameterType="UserAddress">
        select * from jc_user_address where user_id=#{userId}
    </select>
    
    <!-- 查询所有的机器人 -->
     <select id="queryRobot" resultMap="BaseResultMap" parameterType="jcuser">
        select
        <include refid="Base_Column_List"/>
        from jc_user
        where is_robot=1
    </select>
</mapper>