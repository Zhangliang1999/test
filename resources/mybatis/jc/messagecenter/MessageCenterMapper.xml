<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jy.repository.jc.messagecenter.MessageCenterDao">
    <resultMap id="BaseResultMap" type="MessageCenter">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="msg_id" property="msgId" jdbcType="VARCHAR"/>
        <result column="title" property="title" jdbcType="VARCHAR"/>
        <result column="content" property="content" jdbcType="VARCHAR"/>
        <result column="send_time" property="sendTime" jdbcType="TIMESTAMP"/>
        <result column="msg_type" property="msgType" jdbcType="DECIMAL"/>
        <result column="state" property="state" jdbcType="VARCHAR"/>
        <result column="oper_id" property="operId" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>
    <!--接收人-->
    <resultMap id="receiverMap" type="MessageReceiver" >
        <id column="msg_id" property="msgId" jdbcType="VARCHAR"/>
        <result column="receiver" property="receiver" jdbcType="VARCHAR" />
        <result column="mobile" property="mobile" jdbcType="VARCHAR"/>
        <result column="real_name" property="realName" jdbcType="VARCHAR"/>
        <result column="nick_name" property="nickName" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
    msg_id, title, content, send_time, msg_type, state, oper_id, create_time, update_time
  </sql>
    <select id="find" resultMap="BaseResultMap" parameterType="MessageCenter">
        select
        <include refid="Base_Column_List"/>
        from jc_message_center
        where msg_id = #{msgId,jdbcType=VARCHAR}
    </select>
    <select id="findByPage" resultMap="BaseResultMap" parameterType="MessageCenter">
        select
        <include refid="Base_Column_List"/>
        from jc_message_center
        where 1=1
        <if test="param.msgType != null">
            and msg_type=#{param.msgType}
        </if>
        <if test="param.state != null">
            and state=#{param.state}
        </if>
        <if test="param.keyWord != null">
            and (
            title LIKE CONCAT('%',#{param.keyWord},'%')
            or content LIKE CONCAT('%',#{param.keyWord},'%')
            )
        </if>
    </select>
    <delete id="delete" parameterType="MessageCenter">
    delete from jc_message_center
    where msg_id = #{msgId,jdbcType=VARCHAR};
    delete from jc_message_receiver where msg_id = #{msgId,jdbcType=VARCHAR};
  </delete>
    <delete id="deleteBatch" parameterType="java.util.List">
        delete from jc_message_center
        where msg_id in(
        <foreach item="o" collection="list" open="" separator="," close="">
            #{o.msgId}
        </foreach>
        );
        delete from jc_message_receiver where msg_id in(
        <foreach item="o" collection="list" open="" separator="," close="">
            #{o.msgId}
        </foreach>
        );
    </delete>
    <insert id="insert" parameterType="MessageCenter">
    insert into jc_message_center (msg_id, title, content,
      send_time, msg_type, state, oper_id, create_time,update_time)
    values (#{msgId,jdbcType=VARCHAR}, #{title,jdbcType=VARCHAR}, #{content,jdbcType=VARCHAR}, 
       #{sendTime,jdbcType=TIMESTAMP}, #{msgType,jdbcType=DECIMAL},
      #{state,jdbcType=VARCHAR}, #{operId,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP},#{updateTime,jdbcType=TIMESTAMP})
  </insert>
    <update id="update" parameterType="MessageCenter">
        update jc_message_center
        <set>
            send_time = #{sendTime,jdbcType=TIMESTAMP},
            <if test="title != null">
                title = #{title,jdbcType=VARCHAR},
            </if>
            <if test="content != null">
                content = #{content,jdbcType=VARCHAR},
            </if>
            <if test="msgType != null">
                msg_type = #{msgType,jdbcType=DECIMAL},
            </if>
            <if test="state != null">
                state = #{state,jdbcType=VARCHAR},
            </if>
            <if test="operId != null">
                oper_id = #{operId,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
        </set>
        where msg_id = #{msgId,jdbcType=VARCHAR}
    </update>
    <!--添加用户-->
    <insert id="insertReceivers" parameterType="java.util.List">
        insert into jc_message_receiver (msg_id, receiver)
        values
        <foreach collection="list" item="o" separator=",">
        (#{o.msgId,jdbcType=VARCHAR}, #{o.receiver,jdbcType=VARCHAR})
        </foreach>
    </insert>
    <!--删除接收人-->
    <delete id="deleteReceivers" parameterType="java.lang.String">
        DELETE FROM jc_message_receiver
        WHERE msg_id=#{msgId,jdbcType=VARCHAR}
    </delete>
    <select id="findReceivers" resultMap="receiverMap" parameterType="MessageCenter">
        SELECT a.mobile,a.nick_name,a.real_name,b.msg_id,b.receiver
        FROM jc_user a, jc_message_receiver b WHERE a.user_id=b.receiver
        and b.msg_id=#{msgId}
    </select>
</mapper>